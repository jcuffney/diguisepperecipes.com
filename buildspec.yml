version: 0.2

env:
  variables:
    ENV_BUCKET: com.diguisepperecipes.env
    ENV_KEY: .env
    CF_DISTRIBUTON_ID: E25EPOYAMI1LWO


phases:

  install:
    commands:
      # - git config --global url."https://${GITHUB_ACCESS_TOKEN}:x-oauth-basic@github.com/".insteadOf "ssh://git@github.com/"
      - NODE_ENV=test npm install

  # pre_build:
  #   commands:
  #     - |
  #       echo Loading env vars from $ENV_BUCKET/$ENV_KEY

  #       aws s3api get-object \
  #         --bucket $ENV_BUCKET \
  #         --key $ENV_KEY \
  #         .env;

  build:
    commands:
      - npm run build
                            
  post_build:
    commands:
      # - npm run verify
      - cp ./template.yml build/template.yml
      - aws s3 sync ./build s3://diguisepperecipes.com  --delete
      - aws cloudfront create-invalidation --distribution-id ${CF_DISTRIBUTON_ID} --paths *

artifacts:
  files:
    - "**/*"
